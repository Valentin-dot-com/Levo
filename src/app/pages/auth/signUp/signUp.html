<form class="sign-up-form" [formGroup]="signUpForm" (ngSubmit)="onSignUp()">
  <h2>Create your account:</h2>
  @if (!loading()) {
    <div class="input-container">
      <label for="firstName">First name</label>
      <input
        id="firstName"
        type="text"
        formControlName="firstName"
        required
        autocomplete="given-name"
        class="sign-up-input"
        [class.error]="signUpForm.get('firstName')?.invalid && signUpForm.get('firstName')?.touched"
      />
      @if (signUpForm.get('firstName')?.invalid && signUpForm.get('firstName')?.touched) {
        <span class="feedback-invalid">First name is required</span>
      }
    </div>

    <div class="input-container">
      <label for="lastName">Last name</label>
      <input
        id="lastName"
        type="text"
        formControlName="lastName"
        required
        autocomplete="family-name"
        class="sign-up-input"
        [class.error]="signUpForm.get('lastName')?.invalid && signUpForm.get('lastName')?.touched"
      />
      @if (signUpForm.get('lastName')?.invalid && signUpForm.get('lastName')?.touched) {
        <span class="feedback-invalid">Last name is required</span>
      }
    </div>

    <div class="input-container">
      <label for="email">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        required
        autocomplete="email"
        class="sign-up-input"
        [class.error]="signUpForm.get('email')?.invalid && signUpForm.get('email')?.touched"
      />
      @if (signUpForm.get('email')?.invalid && signUpForm.get('email')?.touched) {
        <span class="feedback-invalid">Please enter a valid email</span>
      }
    </div>

    <div class="input-container password">
      <label for="password">Password</label>
      <input
        id="password"
        [type]="showPassword() ? 'text' : 'password'"
        formControlName="password"
        required
        autocomplete="new-password"
        class="sign-up-input password-input"
        [class.error]="signUpForm.get('password')?.invalid && signUpForm.get('password')?.touched"
      />
      <button
        type="button"
        class="toggle-password-btn"
        (click)="togglePasswordVisibility()"
        [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'"
      >
        @if (showPassword()) {
          <app-icon-hide />
        } @else {
          <app-icon-show />
        }
      </button>
      @let passwordControl = signUpForm.get('password');
      @let strength = passwordControl?.errors?.['passwordStrength'];

      @if (passwordControl?.touched) {

        @if (passwordControl?.errors?.['required']) {
          <span class="feedback-invalid">Password is required</span>
        }

        @if (passwordControl?.errors?.['minlength']) {
          <span class="feedback-invalid">Password must be at least 8 characters</span>
        }

        @if (strength) {
          <span class="feedback-invalid">Password requirements:</span>
          <ul class="password-rules">
            <li [class.valid]="strength?.hasUpperCase">
              {{ strength?.hasUpperCase ? 'Contains' : 'Missing ' }} at least one uppercase letter (A-Z)
            </li>

            <li [class.valid]="strength?.hasLowerCase">
              {{ strength?.hasLowerCase ? 'Contains' : 'Missing' }} at least one lowercase letter (a-z)
            </li>

            <li [class.valid]="strength?.hasNumeric">
              {{ strength?.hasNumeric ? 'Contains' : 'Missing' }} at least one number (0-9)
            </li>

            <li [class.valid]="strength?.hasSymbol">
              {{ strength?.hasSymbol ? 'Contains' : 'Missing' }} at least one symbol (!@#$%^&*...)
            </li>
          </ul>
        }
      }
    </div>

    <div class="input-container">
      <label for="confirmPassword">Confirm your password</label>
      <input
        id="confirmPassword"
        [type]="showPassword() ? 'text' : 'password'"
        formControlName="confirmPassword"
        required
        autocomplete="new-password"
        class="sign-up-input"
        [class.error]="(signUpForm.get('confirmPassword')?.invalid || signUpForm.errors?.['passwordMismatch']) && signUpForm.get('confirmPassword')?.touched"
      />
      @if (signUpForm.get('confirmPassword')?.touched) {
        @if (signUpForm.get('confirmPassword')?.errors?.['required']) {
          <span class="feedback-invalid">Please confirm your password</span>
        }
        @if (signUpForm.errors?.['passwordMismatch'] && !signUpForm.get('confirmPassword')?.errors?.['required']) {
          <span class="feedback-invalid">Passwords do not match</span>
        }
      }
    </div>

    <button class="submit-btn" [class.success]="successMessage()" type="submit" [disabled]="signUpForm.invalid || loading()">
      Create account
    </button>
  }

  @if (successMessage() && !loading()) {
    <span class="success submit-msg">
      <p>Good news!</p>
      <p>{{ successMessage() }}</p>
    </span>
  }

  @if (errorMessage() && !loading()) {
    <span class="error submit-msg">
      <p>{{ errorMessage() }}</p>
    </span>
  }

  @if (loading()) {
    <span class="loading-container">
      <p>Trying to create your account...</p>
      <app-loader />
    </span>
  }
</form>
